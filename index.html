<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyita QA Documentation</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon fallback -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
    <header>
        <div class="header-content">
            <img src="images/logo.png" alt="Joyita Logo" class="header-logo">
            <div class="header-text">
                <h1>Joyita QA Documentation</h1>
                <p>Comprehensive quality assurance tracking and verification system</p>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="status-summary">
            <div class="status-card">
                <i class="fas fa-file-alt"></i>
                <h3>Documents</h3>
                <p id="documents-count">0/2</p>
            </div>
            <div class="status-card">
                <i class="fas fa-clipboard-check"></i>
                <h3>Test Plans</h3>
                <p id="plans-count">0/2</p>
            </div>
            <div class="status-card">
                <i class="fas fa-tasks"></i>
                <h3>Test Cases</h3>
                <p id="cases-count">0/2</p>
            </div>
            <div class="status-card">
                <i class="fas fa-percentage"></i>
                <h3>Completion</h3>
                <p id="completion-percent">0%</p>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">Verification progress: 0% complete</div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('documentation')">
                <i class="fas fa-file-alt"></i> Documentation
            </button>
            <button class="tab-button" onclick="openTab('test-plan')">
                <i class="fas fa-clipboard-check"></i> Test Plan
            </button>
            <button class="tab-button" onclick="openTab('test-cases')">
                <i class="fas fa-tasks"></i> Test Cases
            </button>
        </div>

        <div id="documentation" class="tab-content active">
            <h2><i class="fas fa-file-alt"></i> Documentation</h2>
            <div class="doc-actions">
                <button class="doc-button" onclick="viewDoc('https://docs.google.com/document/d/your-documentation-id')">
                    <i class="fas fa-eye"></i> View Document
                </button>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="doc-qa-lead" onchange="verifyCheckbox(this, 'documentation', 'qaLead')">
                    Verified by QA Lead
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="documentation-qa-lead-message" class="message"></div>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="doc-pm" onchange="verifyCheckbox(this, 'documentation', 'projectManager')">
                    Verified by Project Manager
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="documentation-project-manager-message" class="message"></div>
            </div>
        </div>

        <div id="test-plan" class="tab-content">
            <h2><i class="fas fa-clipboard-check"></i> Test Plan</h2>
            <div class="doc-actions">
                <button class="doc-button" onclick="viewDoc('https://docs.google.com/document/d/your-test-plan-id')">
                    <i class="fas fa-eye"></i> View Test Plan
                </button>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="plan-qa-lead" onchange="verifyCheckbox(this, 'testPlan', 'qaLead')">
                    Verified by QA Lead
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="testPlan-qa-lead-message" class="message"></div>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="plan-pm" onchange="verifyCheckbox(this, 'testPlan', 'projectManager')">
                    Verified by Project Manager
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="testPlan-project-manager-message" class="message"></div>
            </div>
        </div>

        <div id="test-cases" class="tab-content">
            <h2><i class="fas fa-tasks"></i> Test Cases</h2>
            <div class="sheet-actions">
                <button class="sheet-button" onclick="viewSheet('https://docs.google.com/spreadsheets/d/your-test-cases-id')">
                    <i class="fas fa-eye"></i> View Test Cases
                </button>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="cases-qa-lead" onchange="verifyCheckbox(this, 'testCases', 'qaLead')">
                    Verified by QA Lead
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="testCases-qa-lead-message" class="message"></div>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="cases-pm" onchange="verifyCheckbox(this, 'testCases', 'projectManager')">
                    Verified by Project Manager
                    <span class="verification-badge">Pending</span>
                </label>
                <div id="testCases-project-manager-message" class="message"></div>
            </div>
        </div>
    </div>

    <div class="fab tooltip" onclick="showSummary()">
        <i class="fas fa-chart-pie"></i>
        <span class="tooltiptext">Click to see verification summary</span>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCT6bunVIe9tyMWFo0dXNURYf_q4_ZmJxM",
  authDomain: "joyitaqadocumentation.firebaseapp.com",
  projectId: "joyitaqadocumentation",
  storageBucket: "joyitaqadocumentation.firebasestorage.app",
  messagingSenderId: "71921927945",
  appId: "1:71921927945:web:fc2fce50e912b1133f75d8",
  measurementId: "G-L72ELXD4FL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Object to store checkbox states locally
        const checkboxStates = {
            'documentation-qaLead': false,
            'documentation-projectManager': false,
            'testPlan-qaLead': false,
            'testPlan-projectManager': false,
            'testCases-qaLead': false,
            'testCases-projectManager': false
        };

        // Make functions globally accessible
        window.openTab = function(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`button[onclick="openTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).style.animation = 'fadeIn 0.5s ease-out';
        };

        window.verifyCheckbox = async function(checkbox, tabId, role) {
            console.log('verifyCheckbox called for', tabId, role);
            const id = `${tabId}-${role}`;
            const messageDiv = document.getElementById(`${tabId}-${role === 'qaLead' ? 'qa-lead' : 'project-manager'}-message`);
            if (!messageDiv) console.error(`Message div not found for id: ${tabId}-${role === 'qaLead' ? 'qa-lead' : 'project-manager'}-message`);
            const badge = checkbox.parentElement.querySelector('.verification-badge');
            const correctCode = 'QAJoyita';

            if (checkbox.checked) {
                console.log('Checkbox checked, prompting for code');
                const userCode = prompt('Enter verification code:');
                console.log('User entered:', userCode);
                if (userCode === correctCode) {
                    console.log('Correct code entered, attempting Firestore update');
                    try {
                        const docRef = doc(db, 'verifications', tabId);
                        await setDoc(docRef, { [role]: 'Verified' }, { merge: true });
                        console.log('Firestore update successful');
                        checkboxStates[id] = true;
                        if (messageDiv) {
                            messageDiv.textContent = 'Verification successful!';
                            messageDiv.className = 'message success';
                            messageDiv.style.display = 'block';
                        }
                        if (badge) {
                            badge.textContent = 'Verified';
                            badge.style.backgroundColor = '#4cc9f0';
                        }
                        updateProgress();
                    } catch (error) {
                        console.error('Error updating Firestore:', error.message, error);
                        checkbox.checked = false;
                        checkboxStates[id] = false;
                        if (messageDiv) {
                            messageDiv.textContent = 'Failed to save. Check console for details.';
                            messageDiv.className = 'message error';
                            messageDiv.style.display = 'block';
                        }
                    }
                } else {
                    console.log('Incorrect code entered');
                    checkbox.checked = false;
                    checkboxStates[id] = false;
                    if (messageDiv) {
                        messageDiv.textContent = 'Incorrect code.';
                        messageDiv.className = 'message error';
                        messageDiv.style.display = 'block';
                    }
                }
            } else {
                console.log('Checkbox unchecked');
                try {
                    const docRef = doc(db, 'verifications', tabId);
                    await setDoc(docRef, { [role]: 'Pending' }, { merge: true });
                    console.log('Firestore update to Pending successful');
                    checkboxStates[id] = false;
                    if (messageDiv) messageDiv.style.display = 'none';
                    if (badge) {
                        badge.textContent = 'Pending';
                        badge.style.backgroundColor = 'var(--gray)';
                    }
                    updateProgress();
                } catch (error) {
                    console.error('Error updating Firestore to Pending:', error.message, error);
                    if (messageDiv) {
                        messageDiv.textContent = 'Failed to update. Check console for details.';
                        messageDiv.className = 'message error';
                        messageDiv.style.display = 'block';
                    }
                }
            }
        };

        window.updateProgress = function() {
            const totalCheckboxes = Object.keys(checkboxStates).length;
            let verifiedCount = 0;
            for (const key in checkboxStates) {
                if (checkboxStates[key]) verifiedCount++;
            }
            const percentComplete = Math.round((verifiedCount / totalCheckboxes) * 100);
            document.getElementById('progress-bar').style.width = `${percentComplete}%`;
            document.getElementById('progress-text').textContent = `Verification progress: ${percentComplete}% complete`;
            document.getElementById('completion-percent').textContent = `${percentComplete}%`;

            const docVerified = (checkboxStates['documentation-qaLead'] ? 1 : 0) + (checkboxStates['documentation-projectManager'] ? 1 : 0);
            const planVerified = (checkboxStates['testPlan-qaLead'] ? 1 : 0) + (checkboxStates['testPlan-projectManager'] ? 1 : 0);
            const casesVerified = (checkboxStates['testCases-qaLead'] ? 1 : 0) + (checkboxStates['testCases-projectManager'] ? 1 : 0);

            document.getElementById('documents-count').textContent = `${docVerified}/2`;
            document.getElementById('plans-count').textContent = `${planVerified}/2`;
            document.getElementById('cases-count').textContent = `${casesVerified}/2`;

            const progressBar = document.getElementById('progress-bar');
            if (percentComplete < 30) progressBar.style.background = 'linear-gradient(90deg, #f72585, #f8961e)';
            else if (percentComplete < 70) progressBar.style.background = 'linear-gradient(90deg, #f8961e, #4cc9f0)';
            else progressBar.style.background = 'linear-gradient(90deg, #4cc9f0, #4361ee)';
        };

        window.showSummary = function() {
            const verifiedCount = Object.values(checkboxStates).filter(state => state).length;
            const totalCount = Object.keys(checkboxStates).length;
            const percentComplete = Math.round((verifiedCount / totalCount) * 100);
            alert(`Verification Summary:\n\nâœ… ${verifiedCount} of ${totalCount} items verified\nðŸ“Š ${percentComplete}% complete`);
        };

        window.viewDoc = function(url) {
            if (url.includes('your-documentation-id') || url.includes('your-test-plan-id') || url.includes('your-test-cases-id')) {
                alert('Please replace the placeholder URL with your actual Google Doc/Sheet link.');
            } else {
                window.open(url, '_blank');
            }
        };

        window.viewSheet = function(url) {
            viewDoc(url);
        };

        // Initialize Firestore structure and load statuses on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadVerificationStatuses();

            const statusCards = document.querySelectorAll('.status-card');
            statusCards.forEach(card => {
                card.addEventListener('mouseenter', function() { this.style.transform = 'translateY(-5px)'; this.style.boxShadow = '0 8px 15px rgba(0,0,0,0.1)'; });
                card.addEventListener('mouseleave', function() { this.style.transform = ''; this.style.boxShadow = ''; });
            });

            const fab = document.querySelector('.fab');
            fab.addEventListener('click', showSummary);

            async function loadVerificationStatuses() {
                const tabs = ['documentation', 'testPlan', 'testCases'];
                for (const tabId of tabs) {
                    try {
                        const docRef = doc(db, 'verifications', tabId);
                        const docSnap = await getDoc(docRef);
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            const qaLeadCheckbox = document.getElementById(`${tabId}-qa-lead`);
                            const pmCheckbox = document.getElementById(`${tabId}-pm`);
                            if (qaLeadCheckbox && pmCheckbox) {
                                const qaLeadBadge = qaLeadCheckbox.parentElement.querySelector('.verification-badge');
                                const pmBadge = pmCheckbox.parentElement.querySelector('.verification-badge');

                                if (data.qaLead) {
                                    checkboxStates[`${tabId}-qaLead`] = data.qaLead === 'Verified';
                                    qaLeadCheckbox.checked = data.qaLead === 'Verified';
                                    qaLeadBadge.textContent = data.qaLead;
                                    qaLeadBadge.style.backgroundColor = data.qaLead === 'Verified' ? '#4cc9f0' : 'var(--gray)';
                                }
                                if (data.projectManager) {
                                    checkboxStates[`${tabId}-projectManager`] = data.projectManager === 'Verified';
                                    pmCheckbox.checked = data.projectManager === 'Verified';
                                    pmBadge.textContent = data.projectManager;
                                    pmBadge.style.backgroundColor = data.projectManager === 'Verified' ? '#4cc9f0' : 'var(--gray)';
                                }
                            }
                        } else {
                            await setDoc(doc(db, 'verifications', tabId), {
                                qaLead: 'Pending',
                                projectManager: 'Pending'
                            });
                        }
                    } catch (error) {
                        console.error('Error loading verification statuses:', error);
                    }
                }
                updateProgress();
            }
        });
    </script>

    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #e6f0fa;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --white: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: #f5f7fa; color: var(--dark); line-height: 1.6; }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            position: relative;
        }
        header::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%); transform: rotate(30deg); pointer-events: none; }
        .header-content { display: flex; align-items: center; justify-content: center; gap: 2rem; max-width: 1200px; margin: 0 auto; }
        .header-logo { width: 80px; height: 80px; object-fit: contain; filter: brightness(0) invert(1); transition: var(--transition); }
        .header-logo:hover { transform: scale(1.1); }
        header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        header p { font-weight: 300; opacity: 0.9; max-width: 600px; margin: 0 auto; }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }

        .tabs { display: flex; justify-content: center; background-color: var(--white); border-radius: 50px; padding: 0.5rem; margin: 2rem auto; box-shadow: var(--shadow-sm); max-width: 800px; }
        .tab-button { background-color: transparent; border: none; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: 500; cursor: pointer; transition: var(--transition); margin: 0 0.25rem; border-radius: 50px; color: var(--gray); }
        .tab-button:hover { color: var(--primary); transform: translateY(-2px); }
        .tab-button.active { color: var(--white); background: linear-gradient(135deg, var(--primary), var(--secondary)); box-shadow: var(--shadow-sm); }
        .tab-button i { margin-right: 0.5rem; font-size: 1.1rem; }

        .tab-content { display: none; background-color: var(--white); border-radius: 12px; box-shadow: var(--shadow-md); padding: 2rem; margin: 1rem auto; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-content h2 { font-size: 1.75rem; margin-bottom: 1.5rem; color: var(--primary); display: flex; align-items: center; border-bottom: 2px solid var(--primary-light); padding-bottom: 0.75rem; }
        .tab-content h2 i { margin-right: 0.75rem; color: var(--secondary); }

        .doc-actions, .sheet-actions { display: flex; gap: 1rem; margin-bottom: 2rem; }
        .doc-button, .sheet-button { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: var(--white); padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 0.5rem; }
        .doc-button:hover, .sheet-button:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .doc-button i, .sheet-button i { font-size: 1.1rem; }

        .checkbox-group { margin-bottom: 1.5rem; }
        .checkbox-group label { display: flex; align-items: center; font-size: 1.1rem; cursor: pointer; padding: 0.75rem 1rem; border-radius: 8px; transition: var(--transition); background-color: var(--light); }
        .checkbox-group label:hover { background-color: var(--primary-light); transform: translateX(5px); }
        .checkbox-group input[type="checkbox"] { appearance: none; -webkit-appearance: none; width: 22px; height: 22px; border: 2px solid var(--gray); border-radius: 6px; margin-right: 1rem; cursor: pointer; transition: var(--transition); }
        .checkbox-group input[type="checkbox"]:checked { background-color: var(--primary); border-color: var(--primary); }
        .checkbox-group input[type="checkbox"]::after { content: "\f00c"; font-family: "Font Awesome 6 Free"; font-weight: 900; font-size: 12px; color: white; display: none; }
        .checkbox-group input[type="checkbox"]:checked::after { display: block; }

        .verification-badge { margin-left: auto; font-size: 0.8rem; padding: 0.25rem 0.75rem; border-radius: 50px; background-color: var(--gray); color: white; font-weight: 500; transition: var(--transition); }
        .checkbox-group input[type="checkbox"]:checked ~ .verification-badge { background-color: var(--success); }

        .message { margin-top: 0.5rem; padding: 0.75rem 1rem; border-radius: 8px; display: none; animation: slideDown 0.3s ease-out; font-size: 0.9rem; border-left: 4px solid transparent; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .success { background-color: rgba(76, 201, 240, 0.1); color: #0a6c7a; border-left-color: var(--success); }
        .error { background-color: rgba(247, 37, 133, 0.1); color: #a4133c; border-left-color: var(--danger); }

        .progress-container { width: 100%; background-color: #e0e0e0; border-radius: 8px; margin: 2rem 0; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0; transition: width 0.5s ease; border-radius: 8px; }
        .progress-text { text-align: center; font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem; }

        .status-summary { display: flex; justify-content: space-around; margin: 2rem 0; flex-wrap: wrap; }
        .status-card { background: white; padding: 1.5rem; border-radius: 12px; text-align: center; min-width: 150px; margin: 0.5rem; box-shadow: var(--shadow-sm); transition: var(--transition); flex: 1; }
        .status-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .status-card i { font-size: 2rem; margin-bottom: 1rem; color: var(--primary); }
        .status-card h3 { font-size: 1.25rem; margin-bottom: 0.5rem; }
        .status-card p { font-size: 2rem; font-weight: 700; color: var(--dark); }

        @media (max-width: 768px) { header h1 { font-size: 2rem; } .tabs { flex-wrap: wrap; border-radius: 12px; } .tab-button { padding: 0.5rem 1rem; font-size: 0.9rem; margin: 0.25rem; flex: 1 0 calc(50% - 0.5rem); } .tab-content { padding: 1.5rem; } .status-card { min-width: 120px; padding: 1rem; } }
        @media (max-width: 480px) { header h1 { font-size: 1.75rem; } .tab-button { flex: 1 0 100%; margin: 0.15rem 0; } .tab-content { padding: 1rem; } .status-card { min-width: 100%; margin: 0.5rem 0; } }

        .fab { position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: var(--shadow-lg); cursor: pointer; transition: var(--transition); z-index: 1000; }
        .fab:hover { transform: scale(1.1) rotate(90deg); box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3); }
        .tooltip .tooltiptext { visibility: hidden; width: 200px; background-color: var(--dark); color: #fff; text-align: center; border-radius: 6px; padding: 0.5rem; position: absolute; z-index: 1001; bottom: 125%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-size: 0.8rem; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    </style>
</body>
</html>
